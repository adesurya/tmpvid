<!-- Save this as: views/admin/ads.ejs -->
<div style="background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
        <div>
            <h2>Google Ads & Analytics Management</h2>
            <p style="color: #7f8c8d; margin-top: 5px;">Manage programmatic advertising codes and tracking scripts</p>
        </div>
        <button id="addAdsBtn" class="btn btn-primary">
            <i class="fas fa-plus"></i>
            Add New Code
        </button>
    </div>
    
    <div id="adsCodesList">
        <div style="text-align: center; padding: 50px; color: #7f8c8d;">
            <i class="fas fa-ad" style="font-size: 64px; margin-bottom: 20px; color: #bdc3c7;"></i>
            <h3>Loading Ads Settings...</h3>
        </div>
    </div>
</div>

<!-- Add/Edit Ads Modal -->
<div id="adsModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; display: none; align-items: center; justify-content: center;">
    <div style="background: white; padding: 30px; border-radius: 10px; width: 90%; max-width: 700px; max-height: 90vh; overflow-y: auto;">
        <h3 id="modalTitle" style="margin-bottom: 20px;">Add New Ads Code</h3>
        
        <form id="adsForm">
            <input type="hidden" id="adsId" name="id">
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 600;">Code Name:</label>
                    <input type="text" id="adsName" name="name" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;" placeholder="e.g., Header AdSense">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 600;">Type:</label>
                    <select id="adsType" name="type" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                        <option value="google_adsense">Google AdSense</option>
                        <option value="google_ads">Google Ads</option>
                        <option value="analytics">Google Analytics</option>
                        <option value="custom">Custom Code</option>
                    </select>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 600;">Position:</label>
                    <select id="adsPosition" name="position" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                        <option value="header">Header (Head Section)</option>
                        <option value="footer">Footer (Before </body>)</option>
                        <option value="before_video">Before Video Player</option>
                        <option value="after_video">After Video Player</option>
                        <option value="sidebar">Sidebar Area</option>
                    </select>
                </div>
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 600;">Status:</label>
                    <select id="adsStatus" name="status" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                    </select>
                </div>
            </div>
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-weight: 600;">Description (Optional):</label>
                <input type="text" id="adsDescription" name="description" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;" placeholder="Brief description of this code">
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 5px; font-weight: 600;">HTML/JavaScript Code:</label>
                <textarea id="adsCode" name="code" required style="width: 100%; padding: 15px; border: 1px solid #ddd; border-radius: 5px; height: 200px; font-family: 'Courier New', monospace; font-size: 13px;" placeholder="Paste your AdSense, Google Ads, or Analytics code here..."></textarea>
                <small style="color: #666; display: block; margin-top: 5px;">
                    ⚠️ Only paste trusted code from Google or verified sources. This code will be executed on your website.
                </small>
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button type="button" id="cancelAdsBtn" style="padding: 10px 20px; border: 1px solid #ddd; background: white; border-radius: 5px; cursor: pointer;">Cancel</button>
                <button type="submit" id="submitAdsBtn" class="btn btn-primary">
                    <i class="fas fa-save"></i>
                    Save Code
                </button>
            </div>
        </form>
    </div>
</div>

<script>
let editingAdsId = null;

document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('addAdsBtn').addEventListener('click', showAddAdsForm);
    document.getElementById('cancelAdsBtn').addEventListener('click', hideAdsModal);
    document.getElementById('adsForm').addEventListener('submit', handleAdsSubmit);
    
    document.getElementById('adsModal').addEventListener('click', function(e) {
        if (e.target === this) hideAdsModal();
    });
    
    loadAdsCodes();
});

function showAddAdsForm() {
    editingAdsId = null;
    document.getElementById('modalTitle').textContent = 'Add New Ads Code';
    document.getElementById('adsForm').reset();
    document.getElementById('adsModal').style.display = 'flex';
}

function hideAdsModal() {
    document.getElementById('adsModal').style.display = 'none';
    document.getElementById('adsForm').reset();
    editingAdsId = null;
}

async function handleAdsSubmit(e) {
    e.preventDefault();
    
    const formData = new FormData(e.target);
    const data = Object.fromEntries(formData);
    
    try {
        const url = editingAdsId ? `/api/admin/ads/${editingAdsId}` : '/api/admin/ads';
        const method = editingAdsId ? 'PUT' : 'POST';
        
        const response = await fetch(url, {
            method: method,
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (result.success) {
            alert('Ads code saved successfully!');
            hideAdsModal();
            loadAdsCodes();
        } else {
            alert('Error: ' + result.message);
        }
    } catch (error) {
        alert('Failed to save ads code: ' + error.message);
    }
}

async function loadAdsCodes() {
    try {
        const response = await fetch('/api/admin/ads');
        const data = await response.json();
        
        const adsDiv = document.getElementById('adsCodesList');
        
        if (data.success && data.data && data.data.length > 0) {
            adsDiv.innerHTML = data.data.map(ads => `
                <div style="border: 1px solid #e9ecef; border-radius: 8px; padding: 20px; margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div style="flex: 1;">
                            <h4 style="margin-bottom: 5px;">${ads.name}</h4>
                            <p style="color: #7f8c8d; margin: 5px 0;">${ads.description || 'No description'}</p>
                            <div style="display: flex; gap: 15px; margin-top: 10px;">
                                <small style="color: #999;">Type: ${ads.type}</small>
                                <small style="color: #999;">Position: ${ads.position}</small>
                                <small style="color: #999;">Status: <span style="color: ${ads.status === 'active' ? '#27ae60' : '#e74c3c'}">${ads.status}</span></small>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button onclick="editAds('${ads.id}')" class="btn btn-primary" style="padding: 5px 10px; font-size: 12px;">Edit</button>
                            <button onclick="deleteAds('${ads.id}')" class="btn btn-danger" style="padding: 5px 10px; font-size: 12px;">Delete</button>
                        </div>
                    </div>
                </div>
            `).join('');
        } else {
            adsDiv.innerHTML = `
                <div style="text-align: center; padding: 50px; color: #7f8c8d;">
                    <i class="fas fa-ad" style="font-size: 64px; margin-bottom: 20px; color: #bdc3c7;"></i>
                    <h3>No Ads Codes Yet</h3>
                    <p>Add your first Google AdSense, Analytics, or custom advertising code</p>
                </div>
            `;
        }
    } catch (error) {
        console.error('Load ads error:', error);
        document.getElementById('adsCodesList').innerHTML = `
            <div style="text-align: center; padding: 50px; color: #e74c3c;">
                <h3>Failed to Load Ads Codes</h3>
                <p>Error: ${error.message}</p>
            </div>
        `;
    }
}

async function deleteAds(id) {
    if (!confirm('Are you sure you want to delete this ads code?')) return;
    
    try {
        const response = await fetch(`/api/admin/ads/${id}`, { method: 'DELETE' });
        const result = await response.json();
        
        if (result.success) {
            alert('Ads code deleted successfully!');
            loadAdsCodes();
        } else {
            alert('Error: ' + result.message);
        }
    } catch (error) {
        alert('Failed to delete ads code: ' + error.message);
    }
}

function editAds(id) {
    alert('Edit functionality coming soon!');
}
</script>